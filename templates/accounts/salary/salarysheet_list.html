{% extends "base.html" %}

{% block content %}
<div class="py-3">
  <h3 class="text-center mb-4">Salary Sheet List</h3>

  <!-- Filter Toggle + Add New Button -->
  <div class="d-flex justify-content-center gap-3 flex-wrap mb-3">
    <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">
      üîç Show/Hide Filter
    </button>
    <a href="{% url 'accounts:salarysheet_create' %}" class="btn btn-primary">Create New Salary Sheet </a>
  </div>

  <!-- Filter Form -->
  <div class="collapse" id="filterCollapse">
    <form method="get" class="row g-3 mb-4 bg-light p-3 rounded shadow-sm">
      <div class="col-md-3">
        <input type="text" name="name" value="{{ name }}" class="form-control" placeholder="Employee Name">
      </div>
      <div class="col-md-3">
        <input type="month" name="month" value="{{ month }}" class="form-control">
      </div>
      <div class="col-md-3">
        <select name="status" class="form-select">
          <option value="">All Status</option>
          <option value="unpaid" {% if status == 'unpaid' %}selected{% endif %}>Unpaid</option>
          <option value="partial" {% if status == 'partial' %}selected{% endif %}>Partial</option>
          <option value="paid" {% if status == 'paid' %}selected{% endif %}>Paid</option>
        </select>
      </div>

      <!-- Salary Range -->
      <div class="col-md-3">
        <input type="number" step="0.01" name="basic_min" value="{{ basic_min }}" class="form-control" placeholder="Min Basic Salary">
      </div>
      <div class="col-md-3">
        <input type="number" step="0.01" name="basic_max" value="{{ basic_max }}" class="form-control" placeholder="Max Basic Salary">
      </div>

      <div class="col-md-3">
        <input type="number" step="0.01" name="medical_min" value="{{ medical_min }}" class="form-control" placeholder="Min Medical Allowance">
      </div>
      <div class="col-md-3">
        <input type="number" step="0.01" name="medical_max" value="{{ medical_max }}" class="form-control" placeholder="Max Medical Allowance">
      </div>

      <div class="col-md-3">
        <input type="number" step="0.01" name="house_min" value="{{ house_min }}" class="form-control" placeholder="Min House Rent">
      </div>
      <div class="col-md-3">
        <input type="number" step="0.01" name="house_max" value="{{ house_max }}" class="form-control" placeholder="Max House Rent">
      </div>

      <!-- Filter Buttons -->
      <div class="col-md-3 d-flex align-items-end gap-2">
        <button type="submit" class="btn btn-primary w-50">Filter</button>
        <a href="{% url 'accounts:salarysheet_list' %}" class="btn btn-secondary w-50">Reset</a>
      </div>
    </form>
  </div>

  <!-- Table goes here -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle text-center">
      <thead class="table-primary">
        <tr>
          <th>SL</th>
          <th>Name</th>
          <th>Month</th>
          <th>Basic Salary</th>
          <th>Medical</th>
          <th>House Rent</th>
          <th>Total Salary</th>
          <th>Paid</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for sheet in sheets %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ sheet.employee.name }}</td>
          <td>{{ sheet.month|date:"F Y" }}</td>
          <td>‡ß≥{{ sheet.basic_salary }}</td>
          <td>‡ß≥{{ sheet.medical_allowance }}</td>
          <td>‡ß≥{{ sheet.house_rent }}</td>
          <td>‡ß≥{{ sheet.total_salary }}</td>
          <td>‡ß≥{{ sheet.paid_amount }}</td>
          <td>
            {% if sheet.payment_status == "paid" %}
              <span class="badge bg-success">Paid</span>
            {% elif sheet.payment_status == "partial" %}
              <span class="badge bg-warning text-dark">Partial</span>
            {% else %}
              <span class="badge bg-danger">Unpaid</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'accounts:salarysheet_update' sheet.id %}" class="btn btn-sm btn-info">Edit</a>
            <a href="{% url 'accounts:salarysheet_delete' sheet.id %}" class="btn btn-sm btn-danger">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="10" class="text-muted text-center">No salary sheets found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
