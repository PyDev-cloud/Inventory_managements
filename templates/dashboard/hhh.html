{% extends "base.html" %}
{% load humanize %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h3 class="mb-4">ড্যাশবোর্ড</h3>

    <div class="row">
        <!-- মোট সাপ্লায়ার -->
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">মোট সাপ্লায়ার</h5>
                    <p class="card-text">{{ total_suppliers }}</p>
                </div>
            </div>
        </div>

        <!-- মোট প্রোডাক্ট -->
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">মোট প্রোডাক্ট</h5>
                    <p class="card-text">{{ total_products }}</p>
                </div>
            </div>
        </div>

        <!-- মাসিক ক্রয় সংখ্যা -->
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">মাসিক ক্রয় (সংখ্যা)</h5>
                    <p class="card-text">{{ monthly_purchase_count }}</p>
                </div>
            </div>
        </div>

        <!-- মাসিক ক্রয় পরিমাণ -->
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">মাসিক ক্রয় পরিমাণ</h5>
                    <p class="card-text">{{ monthly_purchase_total|floatformat:2 }} ৳</p>
                </div>
            </div>
        </div>

        <!-- মাসিক বিক্রয় পরিমাণ -->
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">মাসিক বিক্রয়</h5>
                    <p class="card-text">{{ monthly_sales_total|floatformat:2 }} ৳</p>
                </div>
            </div>
        </div>

        <!-- লাভ / ক্ষতি -->
        <div class="col-md-3 mb-3">
            <div class="card text-white {% if profit_loss >= 0 %}bg-success{% else %}bg-danger{% endif %}">
                <div class="card-body">
                    <h5 class="card-title">লাভ / ক্ষতি</h5>
                    <p class="card-text">
                        {% if profit_loss >= 0 %}
                            লাভ: {{ profit|floatformat:2 }} ৳
                        {% else %}
                            ক্ষতি: {{ loss|floatformat:2 }} ৳
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- অ্যাকাউন্ট ব্যালেন্স -->
        <div class="col-md-6 mb-3">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">অ্যাকাউন্ট ব্যালান্স</h5>
                    <p>ক্যাশ: {{ cash_balance|floatformat:2 }} ৳</p>
                    <p>ব্যাংক: {{ bank_balance|floatformat:2 }} ৳</p>
                    <p>বিকাশ: {{ bkash_balance|floatformat:2 }} ৳</p>
                </div>
            </div>
        </div>
    </div>

    <!-- চার্ট -->
    <div class="row mt-4">
        <div class="col-md-12">
            <canvas id="monthlyChart" height="100"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('monthlyChart').getContext('2d');
    const monthlyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [
                'ক্রয়', 'ক্রয় পেমেন্ট', 'বিক্রয়', 'বিক্রয় পেমেন্ট',
                'বেতন', 'খরচ', 'ইনভেস্টমেন্ট', 'ফান্ড ট্রান্সফার', 'রিটার্ন'
            ],
            datasets: [{
                label: 'মাসিক রিপোর্ট',
                data: [
                    {{ monthly_purchase_total|default:0 }},
                    {{ monthly_purchase_payment_total|default:0 }},
                    {{ monthly_sales_total|default:0 }},
                    {{ monthly_sales_payment_total|default:0 }},
                    {{ salary_paid|default:0 }},
                    {{ expense_paid|default:0 }},
                    {{ invested|default:0 }},
                    {{ fund_transferred|default:0 }},
                    {{ monthly_return_amount|default:0 }}
                ],
                backgroundColor: [
                    '#007bff', '#6c757d', '#28a745', '#17a2b8',
                    '#ffc107', '#fd7e14', '#20c997', '#6610f2', '#dc3545'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: 'মাসিক আর্থিক প্রতিবেদন (বার চার্ট)'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}


<!-- Return -->
        <div class="col">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">Return Quantity</h5>
                    <p class="card-text">{{ monthly_return_qty }}</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card text-white bg-danger">
                <div class="card-body">
                    <h5 class="card-title">Return Amount</h5>
                    <p class="card-text">{{ monthly_return_amount|floatformat:2 }} ৳</p>
                </div>
            </div>
        </div>